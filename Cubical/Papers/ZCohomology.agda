{-

Please do not move this file. Changes should only be made if
necessary.

This file contains pointers to the code examples and main results from
the paper:

Synthetic Cohomology Theory in Cubical Agda

-}

-- The "--safe" flag ensures that there are no postulates or
-- unfinished goals
{-# OPTIONS --cubical --no-import-sorts --safe #-}
module Cubical.Papers.ZCohomology where

-- Misc.
open import Cubical.Data.Int hiding (_+_)
open import Cubical.Data.Nat
open import Cubical.Foundations.Everything
open import Cubical.HITs.S1
open import Cubical.Data.Sum
open import Cubical.Data.Sigma

-- II
import Cubical.Foundations.Prelude                   as Prelude
import Cubical.Foundations.GroupoidLaws              as GroupoidLaws
import Cubical.Foundations.Path                      as Path
open import Cubical.HITs.S1                          as S1
open import Cubical.HITs.Susp                        as Suspension
open import Cubical.HITs.Sn                          as Sn
open import Cubical.Homotopy.Loopspace               as Loop
open import Cubical.Foundations.HLevels              as n-types
open import Cubical.HITs.Truncation                  as Trunc
open import Cubical.Homotopy.Connected               as Connected
import Cubical.HITs.Pushout                          as Push
import Cubical.HITs.Wedge                            as ‚ãÅ
import Cubical.Foundations.Univalence                as Unival
import Cubical.Foundations.SIP                       as StructIdPrinc
import Cubical.Algebra.Group                         as Gr

-- III
import Cubical.ZCohomology.Base                      as coHom
  renaming (coHomK to K)
import Cubical.HITs.Sn.Properties                    as S
import Cubical.ZCohomology.GroupStructure            as GroupStructure
import Cubical.ZCohomology.Properties                as Properties
  renaming (Kn‚ÜíŒ©Kn+1 to œÉ ; Œ©Kn+1‚ÜíKn to œÉ‚Åª¬π)
import Cubical.Experiments.ZCohomologyOld.Properties as oldCohom

-- IV
import Cubical.Homotopy.EilenbergSteenrod            as ES-axioms
import Cubical.ZCohomology.EilenbergSteenrodZ        as satisfies-ES-axioms
  renaming (coHomFunctor to H^~ ; coHomFunctor' to HÃÇ)
import Cubical.ZCohomology.MayerVietorisUnreduced    as MayerVietoris

-- V
import Cubical.ZCohomology.Groups.Sn                 as H‚ÅøS‚Åø
  renaming (H‚Åø-S·µê‚âÖ0 to H‚Åø-S·µê‚âÖ1)
import Cubical.ZCohomology.Groups.Torus              as H‚ÅøT¬≤
import Cubical.ZCohomology.Groups.Wedge              as H‚Åø-wedge
import Cubical.ZCohomology.Groups.KleinBottle        as H‚ÅøùïÇ¬≤
import Cubical.ZCohomology.Groups.RP2                as H‚Åø‚ÑùP¬≤
  renaming (H¬π-RP¬≤‚âÖ0 to H¬π-RP¬≤‚âÖ1)

----- II. HOMOTOPY TYPE THEORY IN CUBICAL AGDA -----

-- II.A Important notions in Cubical Agda
open Prelude using ( PathP
                   ; _‚â°_
                   ; refl
                   ; cong
                   ; funExt)

open GroupoidLaws using (_‚Åª¬π)

open Prelude using ( transport
                   ; subst
                   ; hcomp)

--- II.B Important concepts from HoTT/UF in Cubical Agda

-- The circle, ùïä¬π
open S1 using (S¬π)

-- Suspensions
open Suspension using (Susp)

-- n-spheres, ùïä‚Åø
open Sn using (S‚Çä)

-- Loop spaces
open Loop using (Œ©^_)

-- Eckmann-Hilton argument
open Loop using (Eckmann-Hilton)

-- n-types Note that we start indexing from 0 in the Cubical Library
-- (so (-2)-types as referred to as 0-types, (-1) as 1-types, and so
-- on)
open n-types using (isOfHLevel)

-- truncations
open Trunc using (hLevelTrunc)

-- elimination principle
open Trunc using (elim)

-- elimination principle for paths
truncPathElim : ‚àÄ {‚Ñì ‚Ñì'} {A : Type ‚Ñì} {x y : A} (n : ‚Ñï)
              ‚Üí {B : Path (hLevelTrunc (suc n) A) ‚à£ x ‚à£ ‚à£ y ‚à£ ‚Üí Type ‚Ñì'}
              ‚Üí ((q : _) ‚Üí isOfHLevel n (B q))
              ‚Üí ((p : x ‚â° y) ‚Üí B (cong ‚à£_‚à£ p))
              ‚Üí (q : _) ‚Üí B q
truncPathElim zero hlev ind q = hlev q .fst
truncPathElim (suc n) {B = B} hlev ind q =
  subst B (Iso.leftInv (Trunc.PathIdTruncIso _) q)
    (help (Œ©Trunc.encode-fun ‚à£ _ ‚à£ ‚à£ _ ‚à£ q))
  where
  help : (q : _) ‚Üí B (Œ©Trunc.decode-fun ‚à£ _ ‚à£ ‚à£ _ ‚à£ q)
  help = Trunc.elim (Œª _ ‚Üí hlev _) ind

-- Connectedness
open Connected using (isConnected)

-- Pushouts
open Push using (Pushout)

-- Wedge sum
open ‚ãÅ using (_‚ãÅ_)


-- III.C Univalence

-- Univalence and the ua function respectively
open Unival using (univalence ; ua)

-- The structure identity principle and the sip function
-- respectively
open StructIdPrinc using (SIP ; sip)

-- Groups
open Gr using (Group)


----- III. ‚Ñ§-COHOMOLOGY IN CUBICAL AGDA -----


-- III.A Eilenberg-MacLane spaces

-- Eilenberg-MacLane spaces K‚Çô
open coHom using (K)

-- Proposition 1
open S using (sphereConnected)

-- Lemma 1
open S using (wedgeConSn)

-- restated to match the formulation in the paper
wedgeConSn' : ‚àÄ {‚Ñì} (n m : ‚Ñï) {A : (S‚Çä (suc n)) ‚Üí (S‚Çä (suc m)) ‚Üí Type ‚Ñì}
            ‚Üí ((x : S‚Çä (suc n)) (y : S‚Çä (suc m)) ‚Üí isOfHLevel ((suc n) + (suc m)) (A x y))
            ‚Üí (f‚Çó : (x : _) ‚Üí A x (ptSn (suc m)))
            ‚Üí (f·µ£ : (x : _) ‚Üí A (ptSn (suc n)) x)
            ‚Üí (p : f‚Çó (ptSn (suc n)) ‚â° f·µ£ (ptSn (suc m)))
            ‚Üí Œ£[ F ‚àà ((x : S‚Çä (suc n)) (y : S‚Çä (suc m)) ‚Üí A x y) ]
                (Œ£[ (left , right) ‚àà ((x : S‚Çä (suc n)) ‚Üí f‚Çó x ‚â° F x (ptSn (suc m)))
                                   √ó ((x : S‚Çä (suc m)) ‚Üí f·µ£ x ‚â° F (ptSn (suc n)) x) ]
                  p ‚â° left (ptSn (suc n)) ‚àô (right (ptSn (suc m))) ‚Åª¬π)
wedgeConSn' zero zero hlev f‚Çó f·µ£ p =
  (wedgeConSn 0 0 hlev f·µ£ f‚Çó p .fst)
   , ((Œª x ‚Üí sym (wedgeConSn 0 0 hlev f·µ£ f‚Çó p .snd .snd x))
   , Œª _ ‚Üí refl) -- right holds by refl
   , rUnit _
wedgeConSn' zero (suc m) hlev f‚Çó f·µ£ p =
  (wedgeConSn 0 (suc m) hlev f·µ£ f‚Çó p .fst)
  , ((Œª _ ‚Üí refl) -- left holds by refl
  , (Œª x ‚Üí sym (wedgeConSn 0 (suc m) hlev f·µ£ f‚Çó p .snd .fst x)))
  , lUnit _
wedgeConSn' (suc n) m hlev f‚Çó f·µ£ p =
  (wedgeConSn (suc n) m hlev f·µ£ f‚Çó p .fst)
   , ((Œª x ‚Üí sym (wedgeConSn (suc n) m hlev f·µ£ f‚Çó p .snd .snd x))
   , Œª _ ‚Üí refl) -- right holds by refl
   , rUnit _

-- +‚Çñ (addition), -‚Çñ and 0‚Çñ
open GroupStructure using (_+‚Çñ_ ; -‚Çñ_ ; 0‚Çñ)

-- Group laws for +‚Çñ
open GroupStructure using ( rUnit‚Çñ ; lUnit‚Çñ
                          ; rCancel‚Çñ ; lCancel‚Çñ
                          ; comm‚Çñ
                          ; assoc‚Çñ)

-- All group laws are equal to refl at 0‚Çñ
-- rUnit‚Çñ (definitional)
0-rUnit‚â°refl : rUnit‚Çñ 0 (0‚Çñ 0) ‚â° refl
1-rUnit‚â°refl : rUnit‚Çñ 1 (0‚Çñ 1) ‚â° refl
0-rUnit‚â°refl = refl
1-rUnit‚â°refl = refl
n‚â•2-rUnit‚â°refl : {n : ‚Ñï} ‚Üí rUnit‚Çñ (2 + n) (0‚Çñ (2 + n)) ‚â° refl
n‚â•2-rUnit‚â°refl = refl

-- rUnit‚Çñ (definitional)
0-lUnit‚â°refl : lUnit‚Çñ 0 (0‚Çñ 0) ‚â° refl
1-lUnit‚â°refl : lUnit‚Çñ 1 (0‚Çñ 1) ‚â° refl
n‚â•2-lUnit‚â°refl : {n : ‚Ñï} ‚Üí lUnit‚Çñ (2 + n) (0‚Çñ (2 + n)) ‚â° refl
0-lUnit‚â°refl = refl
1-lUnit‚â°refl = refl
n‚â•2-lUnit‚â°refl = refl

-- assoc‚Çñ (definitional)
0-assoc‚â°refl : assoc‚Çñ 0 (0‚Çñ 0) (0‚Çñ 0) (0‚Çñ 0) ‚â° refl
1-assoc‚â°refl : assoc‚Çñ 1 (0‚Çñ 1) (0‚Çñ 1) (0‚Çñ 1) ‚â° refl
n‚â•2-assoc‚â°refl : {n : ‚Ñï} ‚Üí assoc‚Çñ (2 + n) (0‚Çñ (2 + n)) (0‚Çñ (2 + n)) (0‚Çñ (2 + n)) ‚â° refl
0-assoc‚â°refl = refl
1-assoc‚â°refl = refl
n‚â•2-assoc‚â°refl = refl

-- comm‚Çñ (‚â° refl ‚àô refl for n ‚â• 2)
0-comm‚â°refl : comm‚Çñ 0 (0‚Çñ 0) (0‚Çñ 0) ‚â° refl
1-comm‚â°refl : comm‚Çñ 1 (0‚Çñ 1) (0‚Çñ 1) ‚â° refl
n‚â•2-comm‚â°refl : {n : ‚Ñï} ‚Üí comm‚Çñ (2 + n) (0‚Çñ (2 + n)) (0‚Çñ (2 + n)) ‚â° refl
0-comm‚â°refl = refl
1-comm‚â°refl = refl
n‚â•2-comm‚â°refl = sym (rUnit refl)

-- lCancel‚Çñ (‚â° refl ‚àô transport refl refl for n = 1
--         and transport refl refl ‚àô transport refl refl for n ‚â• 2)
0-lCancel‚â°refl : lCancel‚Çñ 0 (0‚Çñ 0) ‚â° refl
1-lCancel‚â°refl : lCancel‚Çñ 1 (0‚Çñ 1) ‚â° refl
n‚â•2-lCancel‚â°refl : {n : ‚Ñï} ‚Üí lCancel‚Çñ (2 + n) (0‚Çñ (2 + n)) ‚â° refl
0-lCancel‚â°refl = refl
1-lCancel‚â°refl = sym (lUnit _) ‚àô transportRefl refl
n‚â•2-lCancel‚â°refl = rCancel _

-- rCancel‚Çñ (‚â° transport refl refl for n ‚â• 1)
0-rCancel‚â°refl : rCancel‚Çñ 0 (0‚Çñ 0) ‚â° refl
1-rCancel‚â°refl : rCancel‚Çñ 1 (0‚Çñ 1) ‚â° refl
n‚â•2-rCancel‚â°refl : {n : ‚Ñï} ‚Üí rCancel‚Çñ (2 + n) (0‚Çñ (2 + n)) ‚â° refl
0-rCancel‚â°refl = refl
1-rCancel‚â°refl = transportRefl refl
n‚â•2-rCancel‚â°refl = transportRefl refl

-- Proof that there is a unique h-structure on K‚Çô
-- +‚Çñ defines an h-Structure on K‚Çô
open GroupStructure using (_+‚Çñ_ ; 0‚Çñ ; rUnit‚Çñ ; lUnit‚Çñ ; lUnit‚Çñ‚â°rUnit‚Çñ)

-- and so does Brunerie's addition
open oldCohom using (_+‚Çñ_ ; 0‚Çñ ; rUnit‚Çñ ; lUnit‚Çñ ; rUnitlUnit0)

-- consequently both additions agree
open GroupStructure using (+‚Çñ-unique)
open oldCohom using (addLemma)
additionsAgree : (n : ‚Ñï) ‚Üí GroupStructure._+‚Çñ_ {n = n} ‚â° oldCohom._+‚Çñ_ {n = n}
additionsAgree zero i x y = oldCohom.addLemma x y (~ i)
additionsAgree (suc n) i x y =
  +‚Çñ-unique n (GroupStructure._+‚Çñ_) (oldCohom._+‚Çñ_)
              (GroupStructure.rUnit‚Çñ (suc n)) (GroupStructure.lUnit‚Çñ (suc n))
              (oldCohom.rUnit‚Çñ (suc n)) (oldCohom.lUnit‚Çñ (suc n))
              (sym (lUnit‚Çñ‚â°rUnit‚Çñ (suc n)))
              (rUnitlUnit0 (suc n)) x y i

-- The function œÉ : K‚Çô ‚Üí Œ©K‚Çô‚Çä‚ÇÅ
open Properties using (œÉ)

-- Theorem 1 (K‚Çô ‚âÉ Œ©K‚Çô‚Çä‚ÇÅ)
open Properties using (Kn‚âÉŒ©Kn+1)

-- œÉ and œÉ‚Åª¬π are morphisms
-- (for œÉ‚Åª¬π this is proved directly without using the fact that œÉ is a morphism)
open Properties using (Kn‚ÜíŒ©Kn+1-hom ; Œ©Kn+1‚ÜíKn-hom)

-- Lemma 2 (p ‚àô q ‚â° cong¬≤‚Çä(p,q)) for n = 1 and n ‚â• 2 respectively
open GroupStructure using (‚àô‚â°+‚ÇÅ ; ‚àô‚â°+‚ÇÇ)

-- Lemma 3 (cong¬≤‚Çä is commutative) and Theorem 2 respectively
open GroupStructure using (cong+‚Çñ-comm ; isCommŒ©K)

-- III.B Group structure on H‚Åø(A)

-- +‚Çï (addition), -‚Çï and 0‚Çï
open GroupStructure using (_+‚Çï_ ; -‚Çï_ ; 0‚Çï)

-- Cohomology group structure
open GroupStructure using ( rUnit‚Çï ; lUnit‚Çï
                          ; rCancel‚Çï ; lCancel‚Çï
                          ; comm‚Çï
                          ; assoc‚Çï)

-- Reduced cohomology, group structure
open GroupStructure using (coHomRedGroupDir)

-- Equality of unreduced and reduced cohmology
open Properties using (coHomGroup‚â°coHomRedGroup)


----- IV. THE EILENBERG-STEENROD AXIOMS -----

-- IV.A The axioms in HoTT/UF

-- The axioms are defined as a record type
open ES-axioms.coHomTheory

-- Proof of the claim that the alternative reduced cohomology functor
-- HÃÇ is the same as the usual reduced cohomology functor
_ : ‚àÄ {‚Ñì} ‚Üí satisfies-ES-axioms.H^~ {‚Ñì} ‚â° satisfies-ES-axioms.HÃÇ
_ = satisfies-ES-axioms.coHomFunctor‚â°coHomFunctor'

-- IV.B Verifying the axioms

-- Propositions 2 and 3.
_ : ‚àÄ {‚Ñì} ‚Üí ES-axioms.coHomTheory {‚Ñì} satisfies-ES-axioms.H^~
_ = satisfies-ES-axioms.isCohomTheoryZ


-- III.C Characterizing Z-cohomology groups using the axioms

-- Theorem 3
open MayerVietoris.MV using ( Ker-i‚äÇIm-d ; Im-d‚äÇKer-i
                            ; Ker-Œî‚äÇIm-i ; Im-i‚äÇKer-Œî
                            ; Ker-d‚äÇIm-Œî ; Im-Œî‚äÇKer-d)


----- V. CHARACTERIZING COHOMOLOGY GROUPS DIRECTLY -----

-- V.A
-- Proposition 4 and 5 respectively
open H‚ÅøS‚Åø using (H‚Åø-S‚Åø‚âÖ‚Ñ§ ; H‚Åø-S·µê‚âÖ1)

-- V.B
-- Proposition 6 and 7 respectively
open H‚ÅøT¬≤ using (H¬π-T¬≤‚âÖ‚Ñ§√ó‚Ñ§ ; H¬≤-T¬≤‚âÖ‚Ñ§)

-- V.C
-- Proposition 8 and 9 respectively (H‚Åø(ùïÇ¬≤))
-- ‚Ñ§/2‚Ñ§ is represented by Bool with the unique group structure
open H‚ÅøùïÇ¬≤ using (H¬π-ùïÇ¬≤‚âÖ‚Ñ§ ; H¬≤-ùïÇ¬≤‚âÖBool)

-- First and second cohomology groups of ‚ÑùP¬≤ respectively
open H‚Åø‚ÑùP¬≤ using (H¬π-RP¬≤‚âÖ1 ; H¬≤-RP¬≤‚âÖBool)




----- VI. COMPUTING WITH THE COHOMOLOGY GROUPS -----

import Cubical.Experiments.ZCohomology.Benchmarks
